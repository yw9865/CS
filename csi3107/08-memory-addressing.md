# Lecture 8: Memory Addressing
#Resource #Resource/CS #csi3107 #system-programming #linux #memory

- ëª©ì°¨

---

<aside>
ğŸ’¡ í•µì‹¬ ì •ë¦¬

1. ì¸í…” ì•„í‚¤í…ì²˜ì—ì„œ GDTì˜ í¬ê¸°
2. ë¦¬ëˆ…ìŠ¤ê°€ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ê³  ì™œ ê·¸ë ‡ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€
3. 32ë¹„íŠ¸ ë¨¸ì‹ ì—ì„œ 10, 10, 12ë¡œ PGD, PTE, OFFSETì´ ë‚˜ë‰˜ë©´ í˜ì´ì§€ í…Œì´ë¸”ì˜ ê°œìˆ˜ì™€ í˜ì´ì§€ì˜ í¬ê¸°ëŠ”?
4. 32ë¹„íŠ¸ ë¨¸ì‹ ì—ì„œ extendí•˜ì—¬ 10, 22ë¡œ ë‚˜ë‰˜ë©´ í˜ì´ì§€ í…Œì´ë¸”ì˜ ê°œìˆ˜ì™€ í˜ì´ì§€ì˜ í¬ê¸°ëŠ”?
</aside>

- ì •ë‹µ
    1. GDTëŠ” 8ë°”ì´íŠ¸ì˜ segment descriptorë¥¼ 13ë¹„íŠ¸ë¥¼ í†µí•´ êµ¬ë¶„í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ 2^13 * 8ë°”ì´íŠ¸ = 64KBì´ë‹¤.
    2. ì„¸ê·¸ë¨¼íŠ¸ëŠ” íŠ¹ì • ì•„í‚¤í…ì²˜ì—ì„œë§Œ ì“°ì´ëŠ” ì¸ê¸° ì—†ê³  ë³µì¡í•œ ê°œë…ì´ì—¬ì„œ, ë¦¬ëˆ…ìŠ¤ëŠ” ê°„í¸í•˜ê³  í˜¸í™˜ì„±ìˆê²Œ ì„¤ê²Œí•˜ê¸° ìœ„í•´ ì„¸ê·¸ë¨¼íŠ¸ í™œìš©ì„ ìµœì†Œí™” í–ˆë‹¤. 8142ê°œ ì¤‘ 30ê°œ ì–¸ì €ë¦¬ì˜ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©° í¬ê²Œ 4ê°œì˜ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì‚¬ìš©í•˜ê³  ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì˜ í¬ê¸°ë¥¼ linear address spaceì™€ ë˜‘ê°™ì€ í¬ê¸°(4GB)ë¡œ í†µì¼í–ˆë‹¤.
    3. PGD 1ê°œ + PT 2^10ê°œ. Page Tableì€ ì´ 1025ê°œ
        
        í˜ì´ì§€ëŠ” PTEê°€ 2^10ê°œ ìˆìœ¼ë¯€ë¡œ, í˜ì´ì§€ëŠ” 2^10ê°œ ìˆê³  ê° í˜ì´ì§€ì˜ í¬ê¸°ëŠ” OFFSETë§Œí¼, ì¦‰ 2^12B = 4KBì´ë‹¤.
        
    4. PGD 1ê°œ, í˜ì´ì§€ í…Œì´ë¸”ì€ 1ê°œ
        
        PGD ì—”íŠ¸ë¦¬ëŠ” 2^10ê°œ, í˜ì´ì§€ëŠ” 2^10ê°œ. í˜ì´ì§€ í¬ê¸°ëŠ” 2^22B = ê° 4MB
        
        ![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled.png)
        

8ì¥ì—ì„œëŠ” ë©”ëª¨ë¦¬ì— ê´€í•œ ìì„¸í•œ ë‚´ìš©ì„ ë‹¤ë£¨ê¸° ì „ì— í•˜ë“œì›¨ì–´ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ë‹¤ë£° ì˜ˆì •

**Overview**

![Memory Management Units (MMU) in x86](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%201.png)

Memory Management Units (MMU) in x86

# Segmentation (x86)

ì¸í…” ì•„í‚¤í…ì³ì—ì„œëŠ” ë©”ëª¨ë¦¬ ì£¼ì†Œë¥¼ 3ê°€ì§€ë¡œ ë¶„ë¥˜í•œë‹¤.

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%202.png)

- Logical address
    - ì„¸ê·¸ë¨¼íŠ¸(segment)ì˜ ì£¼ì†Œ
    - íŠ¹ì • ì„¸ê·¸ë¨¼íŠ¸(code, data ë“±)ì˜ ëª‡ ë²ˆì§¸ offsetìœ¼ë¡œ ë‚˜íƒ€ëƒ„
- Linear address (or virtual address)
    - ì„¸ê·¸ë©˜í…Œì´ì…˜ì˜ ê²°ê³¼
    - 0~4GBì˜ ì£¼ì†Œë¡œ ë‚˜íƒ€ë‚¨(32ë¹„íŠ¸ í”„ë¡œì„¸ì„œ ê¸°ì¤€)
- Physical address
    - ì‹¤ì œ ë©”ëª¨ë¦¬ì— ìœ„ì¹˜í•˜ëŠ” ì£¼ì†Œ

## Segmentation in Hardware (x86)

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%203.png)

- ì„¸ê·¸ë¨¼íŠ¸ ìœ ë‹›ì´ logical addressë¥¼ linear addressë¡œ ë³€í™˜í•œë‹¤
    - logical address = segment selector, offset
        - segment selector : 16ë¹„íŠ¸ì˜ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ êµ¬ë¶„í•˜ëŠ” ë ˆì§€ìŠ¤í„°
        - offset : CA dependentí•¨. 32ë¹„íŠ¸ì˜ ì„¸ê·¸ë¨¼íŠ¸ ì•ˆì—ì„œì˜ ì£¼ì†Œ
    
    ![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%204.png)
    
    - segment selectorëŠ” 16ë¹„íŠ¸ì§€ë§Œ, í•˜ìœ„ 3ë¹„íŠ¸ë¥¼ ë‹¤ë¥¸ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ”ë°ì— ì‚¬ìš©
        - 13ë¹„íŠ¸ë¡œ ì„¸ê·¸ë¨¼íŠ¸ ì„ íƒ ê°€ëŠ¥ â†’ ìµœëŒ€ 8142(2^13)ê°œ ì„¸ê·¸ë¨¼íŠ¸ ì¡´ì¬ ê°€ëŠ¥
- x86ì€ ìì£¼ ì“°ì´ëŠ” ì„¸ê·¸ë¨¼íŠ¸ì— ëŒ€í•œ ë ˆì§€ìŠ¤í„°ë¥¼ ë”°ë¡œ ë§ˆë ¨í•´ ë‘ 
    - cs, ds, ss ë ˆì§€ìŠ¤í„°ëŠ” ê°ê° ì½”ë“œ, ë°ì´í„°, ìŠ¤íƒ ì„¸ê·¸ë¨¼íŠ¸ ì˜ì—­ì— ëŒ€í•œ í¬ì¸í„°ì´ë‹¤.

**Segment Descriptor**

- ê° ì„¸ê·¸ë¨¼íŠ¸ëŠ” 8ë°”ì´íŠ¸ì˜ ******************Segment Descriptor******************ê°€ ë‚˜íƒ€ë‚¸ë‹¤.
- ì„¸ê·¸ë¨¼íŠ¸ ë””ìŠ¤í¬ë¦½í„°ëŠ” Global Descriptor Table(GDT) í˜¹ì€ Local Descriptor Table(LDT)ì— ìˆë‹¤.
    - GDTëŠ” ê·¸ëŸ¬ë©´ í¬ê¸°ê°€ 8ë°”ì´íŠ¸ì¸ ìµœëŒ€ 8142ê°œì˜ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ê°–ê³  ìˆì„ ìˆ˜ ìˆë‹¤
    
    â‡’ GDT : 8K * 8B = 64KB
    

**GDT and LDT**

- ë³´í†µ GDT í•˜ë‚˜ê°€ ì •ì˜ë¨
- UP : GDT 1ê°œ, MP : GDT ê° CPU ë§Œí¼ ì¡´ì¬

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%205.png)

- **GDTR**ì´ GDTì˜ ë² ì´ìŠ¤ ì£¼ì†Œì™€ GDTì˜ í¬ê¸°ë¥¼ ì•Œë¦¬ëŠ” 16ë¹„íŠ¸(â†’64KB í‘œí˜„ ê°€ëŠ¥)ì˜ table limitì„ ê°–ê³  ìˆìŒ
    - IDTì˜ ë² ì´ìŠ¤ ì£¼ì†Œ ì •ë³´ë¥¼ ê°–ëŠ” IDTRê³¼ ë™ì¼í•œ ì—­í• .

## Segmentation in Linux

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%206.png)

ë¦¬ëˆ…ìŠ¤ëŠ” ì„¸ê·¸ë¨¼íŠ¸ í™œìš©ì„ ìµœì†Œí™”í–ˆë‹¤.

- ì„¸ê·¸ë¨¼íŠ¸ê°€ íŠ¹ì • ì•„í‚¤í…ì²˜ì—ì„œë§Œ ì“°ì´ëŠ” ì¸ê¸° ì—†ê³  ë³µì¡í•œ êµ¬ì¡°ì´ë‹¤
    - ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ê´€ë¦¬
    - í˜¸í™˜ì„± (portability)
    
    ì„ ìœ„í•´ ë¦¬ëˆ…ìŠ¤ëŠ” ì„¸ê·¸ë¨¼íŠ¸ ëŒ€ì‹  í˜ì´ì§• ê¸°ë²•ì„ ì ê·¹ í™œìš©í–ˆë‹¤.
    

**ë¦¬ëˆ…ìŠ¤ì—ì„œ ì„¸ê·¸ë¨¼íŠ¸ëŠ”**

- ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì˜ í¬ê¸°ê°€ linear address spaceì™€ ê°™ì€ 4GBì´ë‹¤.
- í•œ ì„¸ê·¸ë¨¼íŠ¸ì˜ í¬ê¸°ë¥¼ 8Bì”© í• ë‹¹í•˜ë©´ ìµœëŒ€ 8192ê°œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆì§€ë§Œ, ë¦¬ëˆ…ìŠ¤ëŠ” 4ê°œì˜ ì„¸ê·¸ë¨¼íŠ¸ë§Œ ì‚¬ìš©í•œë‹¤.
    
    ![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%207.png)
    
- ê° ì„¸ê·¸ë¨¼íŠ¸ëŠ”user code, user data, kernel code, kernel data ì˜ì—­ì„ ë‚˜íƒ€ë‚¸ë‹¤.
- 4ê°œì˜ ì„¸ê·¸ë¨¼íŠ¸ ëª¨ë‘ 4GBë¡œ í¬ê¸°ëŠ” ê°™ì§€ë§Œ, *privilege level(*ì ‘ê·¼ ê¶Œí•œ*)*ì´ ë‹¤ë¥´ë‹¤.

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%208.png)

IDTì™€ êµ‰ì¥íˆ ìœ ì‚¬. ì—°ê³„í•´ì„œ ìƒê°í•  ê²ƒ

- IDTì—ì„œ ëª‡ ë²ˆì§¸ ì—”íŠ¸ë¦¬ì¸ì§€ ì¸í„°ëŸ½íŠ¸ ë²¡í„° nì´ ì •í•´ì§€ë©´, segment selectorë¥¼ í†µí•´ GDTì˜ ì„¸ê·¸ë¨¼íŠ¸ ì •ë³´ì— ì ‘ê·¼í•˜ê³ , ì»¤ë„ ì½”ë“œ ì„¸ê·¸ë¨¼íŠ¸ì— ë°”ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

# Paging

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%209.png)

  í˜ì´ì§€ì˜ í•µì‹¬ ì² í•™ì€ ì—°ì†ëœ linear addressë¥¼ ë¶ˆì—°ì†ëœ physical addressì— ë§µí•‘í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

- ë¬¼ë¦¬ ë©”ëª¨ë¦¬ì˜ í¬ê¸°ê°€ ê°€ìƒ ë©”ëª¨ë¦¬ì˜ í¬ê¸°ë³´ë‹¤ ì‘ì•„ë„ ëœë‹¤.
    - 100GB ë¨ì„ ê°€ì§€ê³  ìˆë”ë¼ë„, í”„ë¡œì„¸ìŠ¤ í•˜ë‚˜ë‹¹ 4GBì”© ë¨ì— í• ë‹¹í•œë‹¤ë©´, 25ê°œì˜ í”„ë¡œì„¸ìŠ¤ë°–ì— ì‹¤í–‰í•˜ì§€ ëª»í•œë‹¤.
    - ì¦‰, 4GBì˜ linear address spaceë¥¼ ë¬¼ë¦¬ ë©”ëª¨ë¦¬ì— ì „ë¶€ ì˜¬ë¦¬ëŠ” ê±´ í˜„ì‹¤ì ì´ì§€ ì•Šë‹¤.

## Paging in Hardware (x86)

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%2010.png)

## Paging in Linux

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%2011.png)

- ë©€í‹° ë ˆë²¨ í˜ì´ì§• ì§€ì›
    - ê³µê°„ì„ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ 2ë‹¨ ì ‘ê·¼ì„ í•´ì•¼í•´ì„œ ì‹œê°„ìƒ ì˜¤ë²„í—¤ë“œ ë°œìƒ
- portabilityì™€ scalabilityê°€ ê·¹ëŒ€í™” ì‹œí‚¤ê¸° ìœ„í•´ í™˜ê²½ë§ˆë‹¤ ì½”ë“œì˜ ë³€í™”ë¥¼ ì ê²Œ, generalí•˜ê²Œ ì½”ë”©í–ˆë‹¤.

### Page Directory and Page Table (multi-level paging)

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%2012.png)

### Kernel + Hardware

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%2013.png)

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%2014.png)

MMUì˜ ì ì ˆí•œ ë„ì›€ì„ ë°›ì•„ í˜ì´ì§•ì„ í™œìš©í•œë‹¤.

### x64ì—ì„œ í˜ì´ì§•

![Untitled](Lecture%208%20Memory%20Addressing%20b6a354b270ac4d0d879b5b188d343208/Untitled%2015.png)

- 64ë¹„íŠ¸ëŠ” ë³µì¡í•˜ë‹¤

---